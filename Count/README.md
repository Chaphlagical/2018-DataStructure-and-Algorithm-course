

# 话费统计实验报告

**PB17050948        陈文博** 

## 问题描述

给定一份通话记录文件，包含约10万用户一天共计约100万条通话记录。文件是纯文本格式，每行为一条记录，格式如下：

 ```
手机号码（11位）、呼叫类型（2位，00表示主叫，01表示被叫）、通话时长（4位，以秒为单位）、呼叫发生小区（4位）、换行符（2位，即'\r\n'）
 ```

 例如，文件的第一行：13955191490010225JQHK

 表示手机号码为13955191490的用户在JQHK小区被叫，时长为225秒。

 计费规则如下：

1. 通话时长以分钟为单位计费，不足一分钟按一分钟计算。

2. 主叫每分钟0.40元（40分）、被叫每分钟0.20元（20分）。

 请生成话费账单，输出一份文件，要求输出文件是纯文本格式，每行为一条记录，格式如下：

```
 手机号码（11位）、总费用（8位，以分为单位）、换行符（2位，即'\r\n'）
```

 如输出文件的第一行：1395519149000001240

 表示手机号码为13955191490的用户费用是12.40元。

## 实验内容 

### 1.结构体定义 

​	节点结构体：

```C++
 typedef struct LNode{
    int index;
    LNode*next;
}LNode,*LinkList;
```

​	结构体定义在count.h文件中

### 2. 函数定义

程序count.cpp中声明的函数包括：

**void Count_phone(int\*\*Hash,LinkList&L)
void Create_Bill(int\*\*Hash,LinkList L) **

其中Count_Phone函数用于遍历文件与统计话费，Create_Bill用于生成帐单文件Bill.txt。

遍历过程中将每一行前11个字符存到字符串str中，第13个存到字符变量kind，第14～17存到字符串time，第18～21存到字符串ad，本程序使用哈希表进行查找和统计，用单链表记录所有有效哈希值，观察到每个电话号码均以“139”开头，第四位为5或0，第五位为5或6，因此可以舍弃前三位，将第五位映射成0和1，若第四位出现5，则在舍掉第四位的5并在第五位加上2（保证不冲突），将修改后的值作为哈希值，哈希表设计为两行，一行记录哈希值对应的电话号码，一行记录累计话费，每次有新电话出现，同时扩增链表L，记录哈希值填入index。文件读取处理完毕后，生成帐单只需要遍历链表L，将index作为哈希值搜索相应的电话号码与话费写入文件即可。

### 3. 实验结果

实验用时1024.63ms

### 讨论与总结

通过我所设计的哈希函数，可以将电话号码明显压缩，而且保证不会发生冲突情况，但哈希表所占空间依旧不小，仍然有待改进。



